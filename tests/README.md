# Simple Notes Pro E2Eテスト仕様書

## テスト概要

Simple Notes ProアプリケーションのEnd-to-End (E2E) テストスイートです。Playwrightを使用して、ユーザーの実際の操作フローを自動化テストで検証します。

## テストカバレッジ

### 1. 機能カバレッジ
- ✅ ランディングページ表示・ナビゲーション
- ✅ ユーザー認証（サインアップ・サインイン・サインアウト）
- ✅ メモ管理（作成・編集・削除・一覧表示）
- ✅ 無料プラン制限（3メモまで）
- ✅ 請求・サブスクリプション管理
- ✅ 決済フロー（成功・キャンセル）

### 2. ブラウザカバレッジ
- ✅ Chromium (Desktop Chrome)
- ✅ Firefox (Desktop Firefox) 
- ✅ WebKit (Desktop Safari)
- ✅ Mobile Chrome (Pixel 5)
- ✅ Mobile Safari (iPhone 12)

### 3. テストタイプカバレッジ
- ✅ UI/UX テスト
- ✅ フォームバリデーションテスト
- ✅ ナビゲーションテスト
- ✅ 認証・認可テスト
- ✅ ビジネスロジックテスト
- ✅ エラーハンドリングテスト

## テストファイル詳細

### 1. `landing-page.spec.ts` - ランディングページテスト

**テスト目的**: ランディングページの表示と基本的なナビゲーションを確認

**実施内容**:
- ✅ ページ全体の構造表示確認
  - ヘロセクション表示
  - 機能セクション表示  
  - 料金セクション表示
  - FAQセクション表示
- ✅ CTAボタンからサインアップページへの遷移
- ✅ ヘッダーからサインインページへの遷移
- ✅ 料金プラン情報の正確性確認
  - 無料プラン: ¥0、最大3つのメモ
  - Proプラン: ¥500、無制限のメモ
- ✅ FAQアコーディオンの動作確認

**検証項目数**: 5テストケース

### 2. `auth.spec.ts` - 認証機能テスト

**テスト目的**: ユーザー認証機能の動作を包括的に検証

**実施内容**:
- ✅ サインアップフォーム表示確認
  - フォーム要素の存在確認
  - サインインページへのリンク確認
- ✅ サインインフォーム表示確認
  - フォーム要素の存在確認
  - サインアップページへのリンク確認
- ✅ バリデーション機能確認
  - 無効なメールアドレスのエラー表示
  - 短すぎるパスワードのエラー表示
- ✅ ページ間ナビゲーション確認
- ✅ 認証処理の実行テスト
  - サインアップ処理の実行
  - サインイン処理の実行
- ✅ 認証保護ルートのアクセス制御
  - `/app`へのアクセス制御
  - `/billing`へのアクセス制御

**検証項目数**: 8テストケース

### 3. `notes.spec.ts` - メモ管理機能テスト

**テスト目的**: メモのCRUD操作とUI動作を検証

**実施内容**:
- ✅ メモ一覧ページ構造確認
  - ページタイトル表示
  - 新規作成ボタン表示
- ✅ 新規メモ作成フローテスト
  - 作成ページへのナビゲーション
  - 作成フォーム表示確認
- ✅ フォームバリデーション確認
  - タイトル必須チェック
  - 内容必須チェック
- ✅ メモ作成処理の実行
- ✅ メモ詳細ページ表示確認
- ✅ メモ編集フローテスト
  - 編集ページへのナビゲーション
  - 編集フォーム表示確認
- ✅ メモ削除機能テスト
  - 削除確認ダイアログ表示
- ✅ 検索機能テスト（実装されている場合）

**検証項目数**: 8テストケース

### 4. `free-tier-limits.spec.ts` - 無料プラン制限テスト

**テスト目的**: 無料プランのメモ数制限（3個まで）とアップグレード促進機能を検証

**実施内容**:
- ✅ 制限接近時の警告バナー表示
  - 残り作成可能数の表示
  - アップグレードリンクの表示
- ✅ 制限到達時のメッセージ表示
  - 制限到達メッセージの表示
  - アップグレードボタンの表示
- ✅ 制限到達時の作成防止機能
  - フォーム無効化確認
  - アップグレード促進表示
- ✅ アップグレードフロー導線確認
  - 請求ページへのリダイレクト
- ✅ 使用量メーター表示確認
  - 現在のプラン表示
  - メモ数カウント表示（X/3形式）
- ✅ 各所でのメモ数表示確認
- ✅ アップグレード特典表示確認
- ✅ メモ削除後の数量更新確認

**検証項目数**: 8テストケース

### 5. `billing.spec.ts` - 請求・サブスクリプション管理テスト

**テスト目的**: 請求ページとサブスクリプション管理機能を検証

**実施内容**:
- ✅ 請求ページ基本構造確認
  - ページタイトル表示
  - 現在のプラン情報表示
  - 使用量メーター表示
- ✅ 無料プランユーザー向け表示
  - 無料プラン詳細表示
  - アップグレードボタン表示
- ✅ Proプランユーザー向け表示
  - Proプラン詳細表示
  - サブスクリプション管理ボタン表示
- ✅ プラン比較セクション表示
  - 両プランの特徴比較表示
- ✅ Stripe Checkout連携テスト
  - アップグレードボタンクリック処理
  - Checkoutページへのリダイレクト確認
- ✅ Customer Portal連携テスト
  - 管理ボタンクリック処理
  - Portalページへのリダイレクト確認
- ✅ サブスクリプション状態表示確認
- ✅ 請求日・支払い方法表示確認
- ✅ 請求履歴表示確認（存在する場合）

**検証項目数**: 9テストケース

### 6. `payment-flow.spec.ts` - 決済フローテスト

**テスト目的**: 決済完了・キャンセル後のページ表示と動作を検証

**実施内容**:
- ✅ 決済成功ページ確認
  - 成功メッセージ表示
  - 次のステップ案内表示
  - アクションボタン表示
- ✅ 成功ページからのナビゲーション
  - アプリページへの遷移
  - 請求ページへの遷移
- ✅ 決済キャンセルページ確認
  - キャンセルメッセージ表示
  - 再試行案内表示
  - アクションボタン表示
- ✅ キャンセルページからのナビゲーション
  - 請求ページへの遷移
  - アプリページへの遷移
- ✅ 非認証ユーザーでのページアクセス確認
- ✅ 成功ページでのメッセージング確認
- ✅ 次のステップ情報表示確認
- ✅ キャンセルページでのサポート情報確認
- ✅ セッションタイムアウト処理確認
- ✅ 決済完了詳細情報表示確認

**検証項目数**: 10テストケース

## テスト実行設定

### 対象ブラウザ
- **Desktop**: Chrome, Firefox, Safari
- **Mobile**: Chrome (Pixel 5), Safari (iPhone 12)

### 実行設定
- **並列実行**: 有効
- **リトライ**: CI環境で2回
- **スクリーンショット**: 失敗時のみ
- **動画記録**: 失敗時のみ
- **トレース**: 初回リトライ時

### レポート出力
- **HTML レポート**: `playwright-report/index.html`
- **JSON レポート**: `test-results/results.json`
- **コンソール出力**: リスト形式

## テスト実行方法

```bash
# 全テスト実行
npx playwright test

# 特定のテストファイル実行
npx playwright test landing-page.spec.ts

# 特定のブラウザでテスト実行
npx playwright test --project=chromium

# デバッグモードでテスト実行
npx playwright test --debug

# UIモードでテスト実行
npx playwright test --ui

# レポート表示
npx playwright show-report
```

## 注意事項

### テスト実行前の準備
1. **開発サーバー起動**: `npm run dev` (http://localhost:3000)
2. **Supabase設定**: 環境変数の設定確認
3. **Stripe設定**: テストキーの設定確認

### テストデータについて
- テスト用のモックデータを使用
- 実際の決済は発生しない（Stripeテストモード）
- テスト実行後のデータクリーンアップは手動

### 制限事項
- 実際のSupabase認証が設定されていない場合、認証関連テストは制限される
- Stripe Webhookテストは含まれていない
- メール送信機能のテストは含まれていない

## テスト品質指標

- **総テストケース数**: 48テストケース
- **カバレッジ対象**: 主要機能100%
- **想定実行時間**: 約5-10分（全ブラウザ）
- **成功基準**: 全テストケースの95%以上が成功